# newwifi3 D2 改pandavan 老毛子系统
## 前提：你已经成功刷入pandavan
1. 刷breed
2. 刷入pandavan

# 内网服务公网访问，搭建NAS，家庭物联网控制中心，博客等服务搭建方案  
## 方案一：改动态域名 DDNS（本项目使用）
检验目前宽带是否是公网IP OR 大内网IP，进入biying搜索搜索本机IP，查看出口IP，对比路由器的出口IP，必须一致才是公网IP。 
如果不是公网IP，建议：
- 直接打宽带运营商电话，要求将自己宽带IP改为公网IP(笔者苏州联通成功修改）
- 索要不鸟你的情况下，换宽带运营商，或者建议放弃DDNS方案。

## 方案二：内网穿透
- 内网穿透一般要借助第三方，由于服务端（家庭网络内部设备）非公网IP，只是内网IP，运营是通过流量转发提供服务，传统基于互联网下的TCP/IP协议基本失效。 
- 第三方服务器与服务端保持通信，客户端想和服务端通信时（到公司了想用家庭NAS了），与第三方通信，由第三方进行流量转发。 
- 注意，由于第三方通信有成本，此时使用第三方服务，往往要付费，且一般网络还会限制网络流量和速度。此时可以考虑自建内网穿透服务。参考`frp`项目。

## DDNS
1. 相信你已经拿到了公网IP
2. 登录阿里云申请一个域名，便宜的域名几块钱即可，进行域名备案
3. 点击右上角用户名，进入access管理，创建一个访问阿里云openapi的access count
4. 添加解析，指定IPV4，解析地址先随便填一个（后面可以测试程序有没有运行成功）
5. dlownload该项目，修改main.go 文件中:
    ```
    accessKeyId := "你的acssess id"
    essKeySecret := "你的acesss key"
    ainName := "你的域名"
   ```
6. windows 环境下交叉编译： run ` $Env:GOOS = "linux"; $Env:GOARCH = "mipsle"; go build -o ddns main.go ` ，注意这里面有个坑，我们在SSH进路由器查询linux CPU架构 `uname -a` 返回的是`mips`,（其实应该是mipsle）一度怀疑交叉编译器出了问题。
7. 编译好后将二进制文件ddns copy到路由器的 `etc/storage`目录下，注意一定要是改目录，否则不会进行持久化，放在路由器的其它目录，路由器重启后会删除。 
回到pandavan控制台，点击自定义设备，点击“在路由器启动后执行”,启动脚本中最后一行输入
      ```
      #启动DDNS
       /etc/storage/ddns &
    ```
8. 再次重启路由器，阿里云上面看看是否变更了解析记录的IP地址吧~