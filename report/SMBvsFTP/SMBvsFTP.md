# SMB、FTP协议下传输速度测试与分析
## 传输速度测试基准项
- 服务器：192.168.110.111
- 文件大小： 2579.7MB
- 文件描述：2512张TIFF图像
- 网络拓扑：前后更换网卡均相同

实验数据为多次测量的平均值

## 100M
测试机器网卡：192.168.110.227，有线连接 ，网络协商速率100M  
**SMB协议**  
目录总大小: 2579.7 MB  
总传输耗时: 271.32 seconds  
平均传输速度:9.51 MB/S  
**FTP协议**  
目录总大小: 2579.7 MB  
总传输耗时: 241.62 seconds  
平均传输速度:10.68 MB/S  
**对比**  
百兆下Speed: SMB/FTP=0.89   

## 1000M
测试机器网卡：192.168.110.237，有线连接 ，网络协商速率1000M  
**SMB协议**  
目录总大小: 2579.7 MB  
总传输耗时: 56.5 seconds  
平均传输速度:45.65 MB/S  
**FTP协议**  
目录总大小: 2579.7 MB  
总传输耗时: 38.35 seconds  
平均传输速度:67.28 MB/S  
**对比**  
千兆下 SMB/FTP=0.67  

## 观测结果
1. 总体而言,FTP的传输速度要优于SMB协议。
2. 同时还观察到一个现象，在带宽越高的情况下，FTP速度对比SMB的速度越明显，千兆下提升了47%。  

## 分析 
1. 协议设计和实现：FTP（文件传输协议）是专门用于文件传输的协议， SMB（服务器消息块）协议是用于在计算机网络上共享文件、打印机和其他资源的协议，两者底层都是采用TCP协议。   
2. FTP使用两个独立的连接：一个用于控制命令（端口21），另一个用于数据传输，每一份数据单独起一个TCP。这种设计将命令和数据传输分离，使得协议结构相对简单，控制连接用于解析和执行命令，数据连接专门用于文件传输。   
3. SMB在单个TCP连接上(445端口)同时处理文件传输、状态信息、控制命令等多种信息。这要求SMB协议能够在同一连接上区分和管理多种不同类型的数据和请求。   
4. SMB 协议是一个更复杂的协议，除了文件传输外，还包括许多其他功能，如文件共享、打印机共享、目录浏览和权限管理等。在每个数据包中，SMB 协议需要携带更多的附加信息，以便实现这些功能。  

## 结论
1. FTP本身的协议设计将数据传输和命令控制分离，可以并行在多个TCP上进行数据传输
2. FTP本身数据结构体较SMB简单
3. 这种情况下，带宽越高，零碎文件数据量越大，此时SMB因为协议本身制造的无效数据越多，管道中垃圾数据越多，FTP越能充分利多多TCP并行上传的优势。

## 参考资料
[SMB Message Structure](https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-cifs/4d330f4c-151c-4d79-b207-40bd4f754da9)  
[FTP-RFC959.pdf](report/SMBvsFTP/RFC959.pdf)
